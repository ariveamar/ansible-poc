---
- name: Comscope Test 
  hosts: all
  gather_facts: no
  connection: network_cli
  vars:
    ansible_terminal_stdout_re:
      - pattern: '[\r\n]?[\w\+\-\.:\/\[\]]+(?:\([^\)]+\)){0,3}(?:[>#]) ?$'
      - pattern: '[\r\n]?'  # In order to handle a blank line
    ansible_network_os: icx
    ansible_become: true
    ansible_become_method: enable
    ansible_user: super
    ansible_password: 'P@ssw0rd'
    ansible_become_password: 'P@ssw0rd'
  tasks:
    - name: Enable Interface
      commscope.icx.icx_config:
        lines:
          - enable
        parents: interface ethernet 1/1/16
    - name: Config ACL
      commscope.icx.icx_config:
        lines:
          - sequence 5 deny tcp any any eq 5985
          - sequence 10 deny tcp any any eq 5986
          - sequence 15 deny udp any any eq 5985
          - sequence 20 deny udp any any eq 5986
        parents: ip access-list extended BLOCK_SOC
    - name: Apply ACL to VLAN
      commscope.icx.icx_config:
        lines:
          - ip access-group BLOCK_SOC out
        parents: interface ve 2
